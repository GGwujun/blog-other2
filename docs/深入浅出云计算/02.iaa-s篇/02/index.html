<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-other2/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-other2";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>
      02 | 云虚拟机（一）：云端“攒机”，有哪些容易忽视的要点？ - 大师兄
    </title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/深入浅出云计算/02.iaa-s篇/02" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other2/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>大数据<ul><li><a href="/blog-other2/从0开始学大数据">从0开始学大数据</a></li></ul></span><span>架构师<ul><li><a href="/blog-other2/sre实战手册">sre实战手册</a></li><li><a href="/blog-other2/vim实用技巧必知必会">vim实用技巧必知必会</a></li><li><a aria-current="page" class="active" href="/blog-other2/深入浅出云计算">深入浅出云计算</a></li><li><a href="/blog-other2/说透数字化转型">说透数字化转型</a></li><li><a href="/blog-other2/遗留系统现代化实战">遗留系统现代化实战</a></li></ul></span><span>工作生活<ul><li><a href="/blog-other2/机器学习40讲">机器学习40讲</a></li><li><a href="/blog-other2/职场求生攻略">职场求生攻略</a></li></ul></span><span>杂谈<ul><li><a href="/blog-other2/aI技术内参">aI技术内参</a></li><li><a href="/blog-other2/人工智能基础课">人工智能基础课</a></li><li><a href="/blog-other2/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li><li><a href="/blog-other2/实用密码学">实用密码学</a></li><li><a href="/blog-other2/手把手带你写一门编程语言">手把手带你写一门编程语言</a></li><li><a href="/blog-other2/深入浅出区块链">深入浅出区块链</a></li><li><a href="/blog-other2/说透区块链">说透区块链</a></li><li><a href="/blog-other2/超级访谈对话汤峥嵘">超级访谈对话汤峥嵘</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-other2/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>大数据<ul><li><a href="/blog-other2/从0开始学大数据">从0开始学大数据</a></li></ul></li><li>架构师<ul><li><a href="/blog-other2/sre实战手册">sre实战手册</a></li><li><a href="/blog-other2/vim实用技巧必知必会">vim实用技巧必知必会</a></li><li><a aria-current="page" class="active" href="/blog-other2/深入浅出云计算">深入浅出云计算</a></li><li><a href="/blog-other2/说透数字化转型">说透数字化转型</a></li><li><a href="/blog-other2/遗留系统现代化实战">遗留系统现代化实战</a></li></ul></li><li>工作生活<ul><li><a href="/blog-other2/机器学习40讲">机器学习40讲</a></li><li><a href="/blog-other2/职场求生攻略">职场求生攻略</a></li></ul></li><li>杂谈<ul><li><a href="/blog-other2/aI技术内参">aI技术内参</a></li><li><a href="/blog-other2/人工智能基础课">人工智能基础课</a></li><li><a href="/blog-other2/反爬虫兵法演绎20讲">反爬虫兵法演绎20讲</a></li><li><a href="/blog-other2/实用密码学">实用密码学</a></li><li><a href="/blog-other2/手把手带你写一门编程语言">手把手带你写一门编程语言</a></li><li><a href="/blog-other2/深入浅出区块链">深入浅出区块链</a></li><li><a href="/blog-other2/说透区块链">说透区块链</a></li><li><a href="/blog-other2/超级访谈对话汤峥嵘">超级访谈对话汤峥嵘</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-other2/深入浅出云计算">深入浅出云计算</a></li><li><a href="/blog-other2/深入浅出云计算/01.开篇词">01.开篇词</a><ul><li><a href="/blog-other2/深入浅出云计算/01.开篇词/01"><span>开篇词 | 云计算，这是开发者最好的时代</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-other2/深入浅出云计算/02.iaa-s篇">02.IaaS篇</a><ul><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/01"><span>01 | 区域和可用区：欢迎来到云端数据中心</span></a></li><li><a aria-current="page" class="active" href="/blog-other2/深入浅出云计算/02.iaa-s篇/02"><span>02 | 云虚拟机（一）：云端“攒机”，有哪些容易忽视的要点？</span></a></li><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/03"><span>03 | 云虚拟机（二）：眼花缭乱的虚拟机型号，我该如何选择？</span></a></li><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/04"><span>04 | 云虚拟机（三）：老板要求省省省，有哪些妙招？</span></a></li><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/05"><span>05 | 云硬盘：云上IO到底给不给力？</span></a></li><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/06"><span>06 | 云上虚拟网络：开合有度，编织无形之网</span></a></li><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/07"><span>07 | 云端架构最佳实践：与故障同舞，与伸缩共生</span></a></li><li><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/08"><span>08 | 云上运维：云端究竟需不需要运维？需要怎样的运维？</span></a></li></ul></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇">03.PaaS篇</a><ul><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/01"><span>09 | 什么是PaaS？怎样深入理解和评估PaaS？</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/02"><span>10 | 对象存储：看似简单的存储服务都有哪些玄机？</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/03"><span>11 | 应用托管服务：Web应用怎样在云上安家？</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/04"><span>12 | 云数据库：高歌猛进的数据库“新贵”</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/05"><span>13 | 云上大数据：云计算遇上大数据，为什么堪称天作之合？</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/06"><span>14 | 云上容器服务：从Docker到Kubernetes，迎接云原生浪潮</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/07"><span>15 | 无服务器计算：追求极致效率的多面手</span></a></li><li><a href="/blog-other2/深入浅出云计算/03.paa-s篇/08"><span>16 | 云上AI服务：云AI能从哪些方面帮助构建智能应用？</span></a></li></ul></li><li><a href="/blog-other2/深入浅出云计算/04.结课测试">04.结课测试</a><ul><li><a href="/blog-other2/深入浅出云计算/04.结课测试/01"><span>结课测试｜这些云计算知识，你都掌握了吗？</span></a></li></ul></li><li><a href="/blog-other2/深入浅出云计算/05.结束语">05.结束语</a><ul><li><a href="/blog-other2/深入浅出云计算/05.结束语/01"><span>结束语 | 与云计算一起，迈向未来</span></a></li></ul></li><li><a href="/blog-other2/深入浅出云计算/summary">深入浅出云计算</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="云虚拟机到底是什么？" data-depth="2"><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#云虚拟机到底是什么"><span>云虚拟机到底是什么？</span></a></li><li title="云端“攒机”实战" data-depth="2"><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#云端攒机实战"><span>云端“攒机”实战</span></a></li><li title="课堂总结与思考" data-depth="2"><a href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#课堂总结与思考"><span>课堂总结与思考</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="02--云虚拟机一云端攒机有哪些容易忽视的要点"><a aria-hidden="true" tabindex="-1" href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#02--云虚拟机一云端攒机有哪些容易忽视的要点"><span class="icon icon-link"></span></a>02 | 云虚拟机（一）：云端“攒机”，有哪些容易忽视的要点？</h1><p>你好，我是何恺铎。</p><p>前一讲，我先从数据中心的角度入手，和你讲解了云计算中“区域”和“可用区”的概念，帮助你建立起了大局观。今天，我们就开始进入微观层面，来介绍和讨论IaaS中最重要的核心服务：云虚拟机。</p><p>我想，你可能对虚拟机并不陌生，现在虚拟机的应用已经很普遍了。传统的物理服务器上通过安装虚拟化软件，就可以虚拟出多个互相隔离的虚拟机，来帮助我们提高资源的使用效率。云计算中的虚拟机，本质上也是如此，也是底层计算存储能力的抽象和开放。</p><p>所以你也许会问，那么云虚拟机到底有什么值得讨论的呢？看上去也就是选取CPU、内存、硬盘几大件，然后启动后登录使用，似乎没有什么新鲜的东西？</p><p>没错，云虚拟机粗看起来和传统服务器较为类似。但当你对它的应用逐渐深入、规模不断加大时，就非常有必要去深入了解云虚拟机的特点了，因为你开始需要针对不同的场景进行选型，也要在性能和成本间找到最佳的平衡，让你的应用效益最大化。</p><p>因此，我接下来就会用三讲课程，为你详细讲解下云端虚拟机的“门道”。</p><h2 id="云虚拟机到底是什么"><a aria-hidden="true" tabindex="-1" href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#云虚拟机到底是什么"><span class="icon icon-link"></span></a>云虚拟机到底是什么？</h2><p>云虚拟机，顾名思义，是在云端虚拟出的服务器。这个服务器你可以完全地控制它，从底层操作系统到安装上层应用。</p><p>站在技术实现的角度来讲，虚拟化技术是云虚拟机服务的核心，它本身是一个非常宏大的技术领域。比如你可能听说过Xen、KVM、VMWare、HyperV等等虚拟化产品和技术。云计算中所使用的虚拟化技术，也大都是从这些虚拟化实现方式演化而来的。</p><p>作为开发者，我们当然不需要成为虚拟化技术专家。我们只需要知道，云端的虚拟化技术在不断进步和发展，使得云端虚拟化的性能损耗在不断减少、资源利用率不断提升就可以了。但你很有必要去了解云计算中虚拟机的体系结构，这也是云虚拟机与传统虚拟机的最大不同。</p><p>云虚拟机的体系结构，用一句话来概括一下，就是全面解耦的<strong>计算存储分离</strong>的设计思想。</p><p>小提示：计算存储分离是云计算设计理念中最重要的思想之一，不仅仅体现在虚拟机上，也体现在其他的云服务架构中。我们今后还会不断涉及。</p><p>传统的虚拟化，往往是对单一物理机器资源的纵向切割，计算、存储、网络等各方面的能力都是一台物理机的子集。因此，从可伸缩性的角度来说，传统虚拟机存在较大的局限，当物理机的局部出现故障时，也很容易影响到里面的虚拟机。</p><p>得益于云端大规模的专属硬件以及高速的内部网络，云虚拟机的组成则有所不同。除了核心的CPU与内存部分仍属于一台宿主机外，它的网络、硬盘等其他部分，则可以超脱于宿主机之外，享受云端其他基础设施的能力。大致架构如下图所示：</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage78f9785d6518852a25283a5337646a19a1f9.ceb35e99.jpg" alt=""/></p><p>你要注意的是，这里我所给出的仅仅是一个简化加工之后的示意图。实际的云计算内部实现，会远比这个要复杂和精妙。不同的云的内部，也会有许多不同的专用硬件各显神通。</p><p>所以，云虚拟机，与其说是由一台宿主机虚拟而成的，不如说是云数据中心中的不同部分一起协作，“拼凑”而成的一台机器。这样虚拟出来的机器，我们在使用感受上其实与传统服务器并无不同，但在可扩展性和故障隔离方面，它就具有很大的优势了。</p><p>举个例子来说，一台云虚拟机，它可以同时挂载很多硬盘，还能够插上很多“网卡”，拥有多个不同的外部IP。这就是充分解耦带来的好处。</p><p>各家厂商的云虚拟机服务的名称会略有不同，阿里云称为云服务器ECS（Elastic Compute Service），AWS称为EC2（Elastic Compute Cloud），Azure就叫Virtual Machine，腾讯云则叫做云服务器CVM（Cloud Virtual Machine）等等。</p><p>这里，你需要注意将虚拟机服务和一些建站类服务区分开来，因为它们有时在名称上可能比较类似。比如“云主机”这个叫法，很多云上就是指云虚拟机，在个别云上对应的却是简单建站服务，请你注意不要混淆。</p><p>扩展：建站类服务主要是提供一些网站的托管运行环境，如PHP。它是一个相对受限的环境，严格来说属于PaaS服务的范畴，比较注重易用性。而虚拟机呢，则提供了一台真正意义上的服务器，从操作系统到上层应用，都可以自己控制，比起建站类服务来说要开放、通用得多。</p><p>虽然各个云厂商对云虚拟机有不同的叫法，但它们的产品形态是比较一致的。当你来到虚拟机服务的门户，一般会有一个列表界面，能够列出当前你拥有的所有虚拟机，你可以按照不同字段过滤、删选、排序。你还可以点击某个VM查看详情，界面一般会展示出VM的常用运行指标。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimagef891f86e8298381c2bfcf7d101ff3ea92a91.8cfb1001.jpg" alt=""/></p><p>AWS EC2自带的指标监控</p><h2 id="云端攒机实战"><a aria-hidden="true" tabindex="-1" href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#云端攒机实战"><span class="icon icon-link"></span></a>云端“攒机”实战</h2><p>讲到这里，你已经基本了解云虚拟机的概念了。接下来，让我们进入云虚拟机的实际操作环节。</p><p>所有的云上，创建虚拟机时一般都会有相当贴心的向导，你可以在虚拟机门户上点击“创建”，然后按照步骤一步步进行即可。今天，我们就以在阿里云上创建Linux虚拟机为例，帮你把“攒机”时最主要的环节串一串，同时顺便给你介绍一下，那些在“攒机”时容易被忽视但又非常关键的要点。</p><p>小提示：在本次实验中，建议你选择“按量付费”的付费模式，这也是云计算的经典付费模式。这种模式是按虚拟机的使用时间付费，比较适合短期实验。当然，更多付费模式都各有特点，后面的<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/208917">第4讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中我们会进行比较和探讨。</p><p><strong>第一步，当然是选择和确认虚拟机的所在区域</strong>。区域的概念，我在上一讲中已经提到过，它决定了虚拟机的地理位置。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimagee999e96a0f7c49173b188154929bfbaa9499.1e8c9177.jpg" alt=""/></p><p>小提示：在部分云中，区域是顶级概念，指定新建虚拟机的区域需要你事先在门户的右上角进行选择和切换，如AWS。</p><p>这样，新建的虚拟机就会处于你当前选择的区域。你还可以指定区域内的特定可用区。</p><p><strong>随后，就是虚拟机的配置确认环节</strong>，也就是我们通常所说的什么型号、几个核、几G内存的选择。配置的选择无疑非常重要，我会在下一讲着重介绍，这里我们先不妨选择默认的2核8G配置。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage90b69063f760c1a2bc2fe49e266534ed29b6.1782fcab.jpg" alt=""/></p><p>接着，就有你需要注意的一个要点：<strong>选择操作系统镜像</strong>。在这里，你可以选择虚拟机所要安装和使用的操作系统，比如常见的CentOS和Ubuntu，同时你也需要选择这个系统具体的版本号。</p><p>在操作系统的列表中，你往往会看到厂商的自有操作系统，比如阿里云的Aliyun Linux、AWS的Amazon Linux等。这是一个很有意思的事情。既然已经有诸多流行的Linux发行版了，为什么云厂商还要推出自己的Linux版本呢？我们什么时候才应该考虑使用它们呢？</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage61d961b6f428f8f492ba33a17c641af510d9.968e9483.jpg" alt=""/></p><p>你可以这样理解：</p><ul><li>首先，厂商的Linux版本，在理论上会和自己云上的硬件有更好的适配，这样能够更充分地发挥相关硬件的性能。一般来说，厂商也会在自己的云上进行充分的测试和验证。</li><li>其次，在内核和基础组件的选择上，厂商专有操作系统往往会根据自己的需求判断，来进行一些取舍和裁剪，所以一般会有一个相对苗条的身材，占用比较小的磁盘空间，同时启动速度更快。这是一种更适合云环境的选择，尤其是当你的虚拟机集群规模较大时，就能够显出规模经济效应了。</li><li>再次，厂商操作系统会预装和云的使用操作方面的一些软件包和SDK，能够为你提供便利。比如说，厂商一般会预装该云的命令行工具（CLI，Command Line Interface），像是AWS CLI等。</li><li>另外，当然也有云厂商出于“自主可控”方面的考虑，想拥有自己能完全控制的操作系统，不但技术上可以自主演化，还能防范一些商务合作上的风险。厂商自家的PaaS服务，它的底层也一般是使用自己的操作系统。</li></ul><p>所以，如果你希望操作系统有更好的软件“兼容性”，或是公司有统一的标准，就可以选择熟悉的老牌Linux系统；而如果你有一些大规模、注重性能的业务，不妨考虑尝试下厂商的Linux操作系统。</p><p><strong>接下来，在系统盘方面，我们选择默认给出的40G“高效云盘”即可</strong>。云硬盘的故事非常精彩，我们<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/210423">第5讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中会专项讨论，这里你只需要保持这个默认选项就可以了。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage3331334c79beaad866a9f85b09fdf6d3aa31.3be75c4e.jpg" alt=""/></p><p><strong>点击“下一步”，我们来到网络和安全组的配置页面</strong>。在这里，你可以配置私有网络、IP、带宽等重要的网络选项。虚拟私有网络（VPC）同样是一个很大的话题，我们会在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/211071">第6讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>展开学习。</p><p>这里我们简单起见，请勾选“分配公网IP地址”的选项。这样创建的虚拟机，会自动被分配一个公开IP地址，便于我们稍后从自己的电脑直接发起连接。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimagee50ee5b2880979b3c1a5019a80becb0c600e.6d485434.jpg" alt=""/></p><p>今天我想着重讨论的另一个重点，是接下来选项中的<strong>网络安全组</strong>（Network Security Group, 简称NSG）。如果这里配置不当，就会直接影响虚拟机的使用。很多新同学由于不太了解这个概念，常常会造成无法远程连接登录的情况。</p><p>你可以把网络安全组理解为一层覆盖在虚拟机之外的网络防火墙。它能够控制虚拟机入站、出站的流量，并能根据协议、端口、流向等所设定的规则，来决定是否允许流量通过。</p><p>所以某种程度上，网络安全组和操作系统中我们熟知的防火墙（如Linux的iptables和Windows防火墙）一样，都起到网络安全防护的作用。</p><p>但你需要注意的是它们的区别：网络安全组并不工作在操作系统层面，而是在操作系统层之外，是额外的一层防护。非法流量在尚未到达OS的网络堆栈之前，就已经被它阻断了。所以<strong>NSG的一个优点在于，它不会影响VM的性能。</strong></p><p>另外，<strong>网络安全组是一种可复用的配置</strong>。如果你有大量虚拟机适用于同样的网络控制规则，那么，你就能够很方便地让它们使用同一个网络安全组，这样你管理起来会非常方便。</p><p>网络安全组是绝大多数云都支持和实现了重要特性，它体现了云计算中<strong>软件定义网络</strong>的特点。网络安全组非常灵活，你可以随时更改，规则也会动态生效。</p><p>小提示：当你在排查虚拟机的连通性相关问题时，比如假设你的网站或API无法被访问，那你一定要记得检查网络安全组中的设置，查看它相关的端口和协议是否已经开放。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage4aab4ae25a707929d30b41c1d91c0803dfab.21ddd3a4.jpg" alt=""/></p><p>OK，回到我们虚拟机创建的流程，所以我们要创建或使用一个，至少开放了<strong>22端口</strong>的网络安全组，以便我们能够通过SSH连接上去。阿里云中，就提供了方便的“默认安全组”，我们只需要勾选需要开放的端口，就会帮助我们生成一个安全组实例，并对这台机器启用。你也可以事先手工创建一个安全组，并在此处选择。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage994e998ab7dd2987d2c2adb7aeedb05cca4e.3b12841d.jpg" alt=""/></p><p><strong>再点击下一步，我们就进入了“系统配置”阶段</strong>，在这里，你可以为实例命名，指定用于登录的用户名密码或密钥对等，这里比较简单我就不再赘述了。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage7a917aefdff1f6f390eab112e0c612910991.1c531e9c.jpg" alt=""/></p><p>然后，暂时跳过一些可选的高级设置，<strong>确认订单后，按下“创建实例”，就可以等待虚拟机的生成了</strong>。一般数十秒至数分钟之内，一台崭新的云服务器就会就绪，进入运行状态。</p><p><img src="/blog-other2/static/httpsstatic001geekbangorgresourceimage3d033d6eb8164a7096fad0e1bfca06a88b03.2f1fc5ee.jpg" alt=""/></p><p>此时，你可以通过SSH连接上虚拟机的公开IP，使用hostnamectl命令查看一下虚拟机的信息，嗯，一切正常。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">client@clientVM:~$ ssh -i ./geektime-ali-sh.pem root@101.133.209.214</span></div><div class="token-line"><span class="token plain">    Welcome to Alibaba Cloud Elastic Compute Service !</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">    [root@my-ecs-vm1 ~]# hostnamectl</span></div><div class="token-line"><span class="token plain">       Static hostname: my-ecs-vm1</span></div><div class="token-line"><span class="token plain">             Icon name: computer-vm</span></div><div class="token-line"><span class="token plain">               Chassis: vm</span></div><div class="token-line"><span class="token plain">            Machine ID: 201908292149004344218446xxxxxxxx</span></div><div class="token-line"><span class="token plain">               Boot ID: 2228122a7f3c4b4eb5756824xxxxxxxx</span></div><div class="token-line"><span class="token plain">        Virtualization: kvm</span></div><div class="token-line"><span class="token plain">      Operating System: Aliyun Linux 2.1903 (Hunting Beagle)</span></div><div class="token-line"><span class="token plain">                Kernel: Linux 4.19.57-15.1.al7.x86_64</span></div><div class="token-line"><span class="token plain">          Architecture: x86-6</span></div></pre></div><p>成功地登录上去之后，你就可以正常使用这台机器了。比如，通常我们会使用yum或apt等包管理器进行一些应用软件的安装。</p><p>到这里，我就带你初步体验完了云虚拟机的创建过程。VM类服务的本质就是租用，我们通过在门户上的简单操作，就能够完成一台定制服务器的“租用”过程。</p><p>从原理上说，这和租户从房东那租房子其实没有什么两样。而且云上的租用相当便捷，动动手指你就能轻松完成。唯一不同的是，云厂商一般不会把租客“扫地出门”，只要你按时付费，一般不会出现不允许续租的情况。</p><h2 id="课堂总结与思考"><a aria-hidden="true" tabindex="-1" href="/blog-other2/深入浅出云计算/02.iaa-s篇/02#课堂总结与思考"><span class="icon icon-link"></span></a>课堂总结与思考</h2><p>在今天这一讲中，我先帮助你了解了云虚拟机的一些理论知识，尤其是一些体系结构方面的特点。然后，我们进入了创建云虚拟机的实操环节，了解了相关的流程和步骤，也讨论了其中所牵涉的一些注意事项。<strong>我强烈建议你自己也动手操作一下，完成从创建到连接的全过程，形成一个直观的感受。</strong></p><p>我们把这一讲的要点总结如下：</p><ul><li>云虚拟机是最重要的IaaS服务之一，它基于计算存储分离的架构进行构建；</li><li>云虚拟机的创建过程，由地域、机型、操作系统、存储、网络等多方面选项共同构成；</li><li>云虚拟机可使用云厂商自有操作系统，与云有较好的适配；</li><li>网络安全组是保护云虚拟机的网络防火墙，可以同时应用于多个虚拟机。</li></ul><p>在今天我们实践的过程中，也引出了若干重要的概念和选项，如机型配置、云硬盘、云网络等等。后续我们会逐个地展开讨论，敬请期待。</p><p><strong>最后，给你留下两个思考题</strong>：</p><ul><li>在上面的实验当中，为了便于连接我们给机器自动分配了公网IP。在生产环境中为了安全性考虑，应该尽可能避免给虚拟机分配公网IP，那么这时你如何连接到这些机器呢？</li><li>暂时不再使用的云虚拟机，和传统服务器一样可以“关机”。关机状态的云虚拟机仍然会存在于虚拟机列表中，随时可以再启动。那么，关机之后它还会继续收费吗？</li></ul><p>欢迎你在留言区和我互动，我会第一时间给你反馈。如果觉得有收获，也欢迎你把这篇文章分享给你的朋友。感谢阅读，我们下期再见。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/深入浅出云计算/02.IaaS篇/02.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 16:50:57</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-other2/umi.2006439a.js"></script>
  </body>
</html>
